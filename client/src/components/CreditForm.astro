<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form');
    const salarioMensualInput = document.getElementById('salarioMensual');
    const otrosIngresosInput = document.getElementById('otrosIngresos');
    const ingresosTotalesInput = document.getElementById('ingresosTotales');

    const updateTotalIncome = () => {
      const salarioMensual = parseFloat(salarioMensualInput.value) || 0;
      const otrosIngresos = parseFloat(otrosIngresosInput.value) || 0;
      const ingresosTotales = salarioMensual + otrosIngresos;
      ingresosTotalesInput.value = ingresosTotales.toFixed(2);
    };

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch('http://localhost:3000/usuarios/save', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (!response.ok) {
          throw new Error('Error en la solicitud: ' + response.statusText);
        }

        const result = await response.json();
        console.log(result);
      } catch (error) {
        console.error('Error en la solicitud:', error.message, error);
      }
    });

    salarioMensualInput.addEventListener('input', updateTotalIncome);
    otrosIngresosInput.addEventListener('input', updateTotalIncome);
  });
</script>

<div class="p-8 bg-white">
  <form class=" flex-wrap ">
    <label>
      <span class="block text-gray-700 text-sm font-extrabold">
        Cédula
      </span>
      <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" type="text" name="cedula" required />
    </label>
    <label>
      <span>
        Nombre completo
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="text" name="nombreCompleto" required />
    </label>
    <label>
      <span>
        Correo:
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="email" name="correo" required />
    </label>
    <label>
      <span>
        Número de celular:
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="text" name="numeroCelular" required />
    </label>
    <label>
      <span>
        Salario mensual:
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="number" id="salarioMensual" name="salarioMensual" required />
    </label>
    <label>
      <span>
        Otros ingresos:
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="number" id="otrosIngresos" name="otrosIngresos" required />
    </label>
    <label>
      <span>
        Ingresos totales:
      </span>
      <input class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400" type="number" id="ingresosTotales" name="ingresosTotales" required readonly />
    </label>
    <button class="bg-purple-800 hover:bg-purple-950" type="submit">Enviar</button>
    <a href="/">Regresar</a>
  </form>
</div>
